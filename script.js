!function(){"use strict";var n=function(){var n,t,e=new(window.AudioContext||window.webkitAudioContext),o=this,i=function(n){if(n=n||function(){},1==!!t)return void n(t);var o=new XMLHttpRequest;o.onload=function(){e.decodeAudioData(o.response,function(t){n(t)})},o.open("GET","/sounds/airhorn.mp3"),o.responseType="arraybuffer",o.send()};this.start=function(t){var r=t.loop;i(function(t){n=e.createBufferSource(),n.connect(e.destination),n.buffer=t,n.onended=function(){o.stop()},n.start(0),n.loop=r,n.loopStart=.24,n.loopEnd=.34})},this.stop=function(){!!n==!0&&(n.loop=!1),this.onstopped()},this.onstopped=function(){};var r=function(){i(function(n){t=n})};r()},t=function(n){var t=(n.querySelector(".tooltip"),function(t){t.preventDefault(),window.install.prompt().then(function(){ga("send","event","install","installed"),n.classList.remove("available")})["catch"](function(n){ga("send","event","install","errored")})}),e=function(){window.install.canPrompt().then(function(){n.classList.add("available"),ga("send","event","install","prompted")})};n.addEventListener("click",t.bind(this)),n.addEventListener("touchend",t.bind(this)),e()},e=function(t){var e=t.querySelector(".horn"),o=new n,i=function(n){return 1==!!n&&(n.preventDefault(),n.touches&&n.touches.length>1)?!1:void this.start({loop:!0})},r=function(n){1==!!n&&n.preventDefault(),this.stop()};this.start=function(n){e.classList.add("horning"),o.start(n),o.onstopped=function(){e.classList.remove("horning")},ga("send","event","horn","play")},this.stop=function(){e.classList.remove("horning"),o.stop()},e.addEventListener("mousedown",i.bind(this)),e.addEventListener("touchstart",i.bind(this)),document.documentElement.addEventListener("mouseup",r.bind(this)),document.documentElement.addEventListener("touchend",r.bind(this))};!function(){var n,t,e=!1,o=function(n){return new Promise(function(t,e){n.then(function(n){t(n)})["catch"](function(){e()})})},i=new Promise(function(n,e){t=n});window.addEventListener("beforeinstallprompt",function(o){return e=!0,o.preventDefault(),n=o,t(),!1});var r={};Object.defineProperty(r,"isAvailable",{get:function(){return e}}),r.canPrompt=function(){return i},r.prompt=function(){return new Promise(function(t,i){e===!1&&i("User Agent decided not to prompt"),n.prompt().then(function(){return o(n.userChoice)}).then(function(){t()})["catch"](function(n){i(n)})})},window.install=r}(),window.addEventListener("load",function(){var n=document.getElementById("airhorn"),o=document.getElementById("installer"),i=new e(n);new t(o);"#instant"==location.hash&&i.start({loop:!1}),window.addEventListener("hashchange",function(){"#instant"==location.hash&&i.start({loop:!1})})})}();
